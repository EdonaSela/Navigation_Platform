<section class="page">
  <header class="page-header">
    <h1>Journeys</h1>
    <p class="page-subtitle">Create, view, and manage your trips.</p>
  </header>

  <div class="grid">
    <form class="card" [formGroup]="form" (ngSubmit)="submit()" novalidate>
      <h2>Create Journey</h2>

      <div class="field">
        <label for="startLocation">Start Location</label>
        <input id="startLocation" type="text" formControlName="startLocation" required />
        @if (form.controls.startLocation.invalid && form.controls.startLocation.touched) {
          <p class="field-error" role="alert">Enter a start location.</p>
        }
      </div>

      <div class="field">
        <label for="startTime">Start Time</label>
        <input id="startTime" type="datetime-local" formControlName="startTime" required />
        @if (form.controls.startTime.invalid && form.controls.startTime.touched) {
          <p class="field-error" role="alert">Enter a start time.</p>
        }
      </div>

      <div class="field">
        <label for="arrivalLocation">Arrival Location</label>
        <input id="arrivalLocation" type="text" formControlName="arrivalLocation" required />
        @if (form.controls.arrivalLocation.invalid && form.controls.arrivalLocation.touched) {
          <p class="field-error" role="alert">Enter an arrival location.</p>
        }
      </div>

      <div class="field">
        <label for="arrivalTime">Arrival Time</label>
        <input id="arrivalTime" type="datetime-local" formControlName="arrivalTime" required />
        @if (form.controls.arrivalTime.invalid && form.controls.arrivalTime.touched) {
          <p class="field-error" role="alert">Enter an arrival time.</p>
        }
      </div>

      <div class="field">
        <label for="distanceKm">Distance (km)</label>
        <input
          id="distanceKm"
          type="number"
          inputmode="decimal"
          min="0.01"
          step="0.01"
          formControlName="distanceKm"
          required
        />
        @if (form.controls.distanceKm.invalid && form.controls.distanceKm.touched) {
          <p class="field-error" role="alert">Distance must be at least 0.01 km.</p>
        }
      </div>

      <div class="field">
        <label for="transportType">Transport Type</label>
        <select id="transportType" formControlName="transportType" required>
          <option value="Car">Car</option>
          <option value="Train">Train</option>
          <option value="Bike">Bike</option>
          <option value="Walk">Walk</option>
        </select>
      </div>

      <div class="form-actions">
        <button type="submit" [disabled]="form.invalid || isSubmitting()">
          @if (isSubmitting()) {
            Saving...
          } @else {
            Save Journey
          }
        </button>
      </div>

      @if (successMessage()) {
        <p class="form-success" role="status">{{ successMessage() }}</p>
      }
      @if (errorMessage()) {
        <p class="form-error" role="alert">{{ errorMessage() }}</p>
      }
    </form>

    <div class="card">
      <div class="card-header">
        <h2>Journey List</h2>
        <button type="button" class="ghost" (click)="loadJourneys()" [disabled]="isLoading()">
          Refresh
        </button>
      </div>

      @if (isLoading()) {
        <p class="muted">Loading journeys...</p>
      } @else if (journeys().length === 0) {
        <p class="muted">No journeys yet. Create your first trip.</p>
      } @else {
        <div class="table">
          <div class="table-row table-head">
            <span>Route</span>
            <span>Times</span>
            <span>Transport</span>
            <span>Distance</span>
            <span class="actions">Actions</span>
          </div>
          @for (journey of journeys(); track journey.id) {
            <div class="table-row">
              <span>            {{ journey.startLocation }} -> {{ journey.arrivalLocation }}         
                  @if (journey.isDailyGoalAchieved) {             
                      <span class="reward-badge">Daily Reward</span>         
                     } </span>
              <span>{{ journey.startTime }} â†’ {{ journey.arrivalTime }}</span>
              <span>{{ journey.transportType }}</span>
              <span>{{ journey.distanceKm }} km</span>
              <span class="actions">
                <a class="link" [routerLink]="['/journeys', journey.id]">View</a>
                <button type="button" class="link" (click)="deleteJourney(journey.id)">Delete</button>
              </span>
            </div>
          }
        </div>
      }

      <div class="pager">
        <button type="button" class="ghost" (click)="previousPage()" [disabled]="page() <= 1">
          Previous
        </button>
        <span>Page {{ page() }} of {{ totalPages() }}</span>
        <button type="button" class="ghost" (click)="nextPage()" [disabled]="page() >= totalPages()">
          Next
        </button>
      </div>
    </div>
  </div>
</section>

